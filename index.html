<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tic Tac Toe</title>
  <!--link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'-->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <div class="screen screen-start" id="start">
    <header>
      <h1>Tic Tac Toe</h1>
      <a href="#" class="button">Start game</a>
    </header>
  </div>

  <div class="board" id="board">
    <header>
      <h1>Tic Tac Toe</h1>
      <ul id="players-list">
        <li class="players" id="player1">
          <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" viewBox="0 0 42 42" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-200.000000, -60.000000)" fill="#000000"><g transform="translate(200.000000, 60.000000)"><path d="M21 36.6L21 36.6C29.6 36.6 36.6 29.6 36.6 21 36.6 12.4 29.6 5.4 21 5.4 12.4 5.4 5.4 12.4 5.4 21 5.4 29.6 12.4 36.6 21 36.6L21 36.6ZM21 42L21 42C9.4 42 0 32.6 0 21 0 9.4 9.4 0 21 0 32.6 0 42 9.4 42 21 42 32.6 32.6 42 21 42L21 42Z"/></g></g></g></svg>
        </li>
        <li class="players" id="player2">
          <svg xmlns="http://www.w3.org/2000/svg" width="42" height="43" viewBox="0 0 42 43" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-718.000000, -60.000000)" fill="#000000"><g transform="translate(739.500000, 81.500000) rotate(-45.000000) translate(-739.500000, -81.500000) translate(712.000000, 54.000000)"><path d="M30 30.1L30 52.5C30 53.6 29.1 54.5 28 54.5L25.5 54.5C24.4 54.5 23.5 53.6 23.5 52.5L23.5 30.1 2 30.1C0.9 30.1 0 29.2 0 28.1L0 25.6C0 24.5 0.9 23.6 2 23.6L23.5 23.6 23.5 2.1C23.5 1 24.4 0.1 25.5 0.1L28 0.1C29.1 0.1 30 1 30 2.1L30 23.6 52.4 23.6C53.5 23.6 54.4 24.5 54.4 25.6L54.4 28.1C54.4 29.2 53.5 30.1 52.4 30.1L30 30.1Z"/></g></g></g></svg>
        </li>
      </ul>
    </header>
    <ul class="boxes">
      <li class="box"></li>
      <li class="box"></li>
      <li class="box"></li>
      
      <li class="box"></li>
      <li class="box"></li>
      <li class="box"></li>
      
      <li class="box"></li>
      <li class="box"></li> 
      <li class="box"></li>
    </ul>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

  <script>




  !function(root) {

    function Player(name) {

      this.name = name;

      var _ = {}
      _.binary = parseInt(this.name.charCodeAt(0).toString(2)[2]);
      _.id = _.binary + 1;
      _.element = $('#player'+ _.id);
      _.winner = false;
      _.score = 0;

      this.get = function(name) {
        return  _[name];
      }

      this.addScore = function() {
        _.score++;
      }

      this.subtractScore = function() {
        _.score--;
      }

      this.setWinner = function() {
        _.winner = true
      }

    }


    function Rule(type, options) {
      
      this.type = type;

      var _ = {}
      _.valid = false;
      _.space = 0;
      _.count = 0;
      _.length = 0;
      _.increment = 1;
      _.score = 0;
      _.total = 0;
      _.start = 0;

      _.merge = function (options){
        for (var attrname in options) { 
          this[attrname] = options[attrname];
        }
      }

      _.merge(options);

      this.get = function(name) {
        return  _[name];
      }

      this.validate = function(boxes , current) {

        console.log(_);
        
        for(var i=_.start, len=_.length; i <= len; i = i + _.increment){
          for(var j = 0; j < 3 ; j++) {
            console.groupCollapsed(j);
            console.log(boxes[(i + _.count)]);

            if($(boxes[(i + _.count)]).hasClass('box-filled-'+current)) {
              _.score = _.score + 1;
               console.log('_.score: '+_.score);
               console.log('_.count: '+_.count);
               console.log('_.count: '+_.total);
            }

            if( _.score === 3 &&  _.count === _.total) {
              console.log('WIN!');
              return true;
            }

            _.count = _.count + _.space;
            console.groupEnd();

          }
          _.score = 0;
          _.count = 0;
        }
        
        console.log(_);
        console.log(_.score);
        
         _.score = 0;
         
         return false
      }

    }


    function Board(players) {
      var self = this;

      var _ = {}
      _.players = [];
      _.players = players;
      

      this.players = players;
      this.boxes = $('.boxes > .box');

      _.rules = new Array();
      this.rules = new Array();

      _.current = {};
      _.current.binary = Math.floor((Math.random() * 2));
      _.current.id = _.current.binary + 1;
      _.current.element = $( '#player'+_.current.id);

      _.state = 0;  

      this.get = function(name) {
        return _[name];
      }

      this.addPlayer = function(player) {
        _.players.push(player);
        this.players.push(rule);
      }

      this.addRule = function(rule) {
        _.rules.push(rule);
        this.rules.push(rule);
      }


      _.changeplayer = function() {
        $( _.current.element ).toggleClass('active');

        _.current.binary ^= 1;
        _.current.id = ( _.current.binary + 1 );
        _.current.element = $('#player'+ this.current.id ).toggleClass('active'); 

      }


      _.isDraw = function() {
        var count = 0;

        for (var i = 0, len = self.boxes.length; i < len; i++) {
          if( $(self.boxes[i]).hasClass('box-filled-1') || $(self.boxes[i]).hasClass('box-filled-2') ) {
            count ++;
          }
        }

        if(count === 9) {
          return true;
        }

        return false;
      }


      this.validateboard = function() {
        var valid = false;
        var i = 0;
        var test;

        for(var rule of _.rules) {
          console.groupCollapsed(rule.type);
          valid = rule.validate( self.boxes , _.current.id);
          if(valid === true) {
            break;
          }
          ++i;
          console.groupEnd();
        }
        
        console.log(valid);
        
        if(valid === true) {
          test = 0;
        } else {
          test = _.isDraw();
          console.log();
        }

      }


      $('.boxes').click(function(e) {
        if(e.target.className.indexOf('box-filled') === -1) {
          var int_Active = parseInt( $('#players-list > .active').attr('id').slice(-1) );
          $(e.target).addClass('box-filled-'+int_Active);
          console.groupCollapsed(_.current.element);
          self.validateboard();
          console.groupEnd();
          _.changeplayer();
        }
      });


      _.splash = function() {
        if(_.state === 0) {
          $('.button').click(function() {
            $('#start').fadeOut("slow", function(){
              $("#board").fadeIn("slow");
              $('#player'+ _.current.id ).toggleClass('active')
              _.state = _.current.binary;
            });
          });
        } else {
          $('#start').hide();
          $("#board").show();
        }
      }

      _.splash();

    }

    var board = new Board([ new Player('x'), new Player('o') ]);
    board.addRule( new Rule('row', { space : 1, count : 0, length : 6, increment : 3, total: 2 }) );
    board.addRule( new Rule('column', { space : 3, count : 0, length : 2, increment : 1, total: 6}) );
    board.addRule( new Rule('diagonal-right', { space : 4, count : 0, length : 2, increment : 1, total: 8 }) );
    board.addRule( new Rule('diagonal-left', { space : 2, count : 2, length : 2, increment : 1, start: 2, total: 4 }) );


  }(this);


























/*
  var Player = (function(name){ 

    var exports = {
      name: name,
    };
    

    var _ = {
      winner : 0,
      score : 0,
    }
    
    _.binary = 

    return exports;
    
  }(name));


  console.log(Player);
  
  var test = new Player('x');



  var Board = (function(){ 

    var exports = {
      foo: 5,
      bar: 10
    };
    
    var _ = {
      players : [],
    }
    
    exports.helloMars = function() {
      console.log("Hello Mars!");
    };
    
    exports.goodbye = function() {
      console.log("Goodbye!");
    };
    
    return exports
    
  }());








    var splashScreen = false;

    function player(name) {
      this.name = name;
      this.binary = Math.floor((Math.random() * 2));
      this.id = this.binary + 1;
      this.element = $('#player'+ this.id ).toggleClass('active');
      this.winner = false;
      this.score = 0;
    }

    function rule(type) {
      this.type = type;
      this.spaces = 0;
      this.blocks = 3;
      this.valid = false;
      this.counted = {
        selected: 0,
        space: 0,
        row: 0,
        column: 0
      }
    }



    var player1 = new player('x');
    console.log(player1);
    
    var player2 = new player('o');
    console.log(player2);
    
    var rule1 = new rule('row');
    console.log(rule1);
    
    var rule2 = new rule('column', 2);
    console.log(rule2);
    
    var rule3 = new rule('diagnol', 1);
    console.log(rule3);
    
    
    

*/






/*
  
  
   function RuleRow() {
      Rule.call(this, 'row');
      
      this.validate = function() {

        var board =[1, 1, 2, 1, 2, 0, 0, 0, 0];
        var c = 0;
        var s = 0;
        var reset = 3;
        var valid = false;
        var p = 1;

        for(var i = 0; i < board.length; i++) {

          if(c > 3) {
            c = 0;
          }

          if(p === board[i]) {
            s ++;
          }

          if(c === 3 && s < 3) {
            s = 0;
          }

          if(c === 3 && s === 3) {
            return true;
          }

          c ++;

        }

        return true;

      }

      this.validate();
      
    }





  //var board =['1:a:x', '1:b:o', '1:c:o', '2:a:x', '2:b:o', '2:c:-', '3:a:-', '3:b:-', '3:c:-'];

  
  
*/

  </script>
</body>
</html>